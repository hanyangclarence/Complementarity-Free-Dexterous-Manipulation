<mujoco model="shadow_right">
  <compiler angle="radian" autolimits="true" meshdir="../assets/shadow_hand/meshes"/>

  <option cone="elliptic" impratio="10"/>

  <default>
    <default class="shadow_right">
      <joint damping="0.1"/>
      <position kp="1"/>
      <geom density="800"/>

      <default class="visual">
        <geom type="mesh" contype="0" conaffinity="0" group="2" rgba="0.9 0.9 0.9 1"/>
      </default>

      <default class="collision">
        <geom group="3" rgba="0.5 0.5 0.5 0.5"/>
      </default>

      <!-- Finger joint classes -->
      <default class="knuckle_joint">
        <joint axis="0 -1 0" range="-0.349 0.349"/>
        <position ctrlrange="-0.349 0.349"/>
      </default>
      <default class="proximal_joint">
        <joint axis="1 0 0" range="-0.262 1.571"/>
        <position ctrlrange="-0.262 1.571"/>
      </default>
      <default class="middle_joint">
        <joint axis="1 0 0" range="0 1.571"/>
        <position ctrlrange="0 1.571"/>
      </default>
      <default class="distal_joint">
        <joint axis="1 0 0" range="0 1.571"/>
        <position ctrlrange="0 1.571"/>
      </default>

      <!-- Little finger classes -->
      <default class="lf_metacarpal_joint">
        <joint axis="1 0 0" range="0 0.785"/>
        <position ctrlrange="0 0.785"/>
      </default>

      <!-- Thumb joint classes -->
      <default class="thumb_base1">
        <joint axis="0 0 -1" range="-1.047 1.047"/>
        <position ctrlrange="-1.047 1.047"/>
      </default>
      <default class="thumb_base2">
        <joint axis="0 1 0" range="0 1.222"/>
        <position ctrlrange="0 1.222"/>
      </default>
      <default class="thumb_mid1">
        <joint axis="0 1 0" range="-0.209 0.209"/>
        <position ctrlrange="-0.209 0.209"/>
      </default>
      <default class="thumb_mid2">
        <joint axis="1 0 0" range="-0.698 0.698"/>
        <position ctrlrange="-0.698 0.698"/>
      </default>
      <default class="thumb_distal">
        <joint axis="1 0 0" range="-0.262 1.571"/>
        <position ctrlrange="-0.262 1.571"/>
      </default>
    </default>
  </default>

  <asset>
    <material name="palm_mat" rgba="0.2 0.2 0.2 1"/>
    <material name="link_mat" rgba="0.3 0.3 0.3 1"/>
    <material name="tip_mat" rgba="0.9 0.9 0.9 1"/>
  </asset>

  <worldbody>
    <body name="palm" childclass="shadow_right">
      <!-- Palm translation joints -->
      <joint name="palm_tx" type="slide" axis="1 0 0" damping="10" range="-0.3 0.3"/>
      <joint name="palm_ty" type="slide" axis="0 1 0" damping="10" range="-0.3 0.3"/>
      <joint name="palm_tz" type="slide" axis="0 0 1" damping="10" range="-0.1 0.5"/>
      <!-- Palm rotation joints -->
      <joint name="palm_rx" type="hinge" axis="1 0 0" damping="10"/>
      <joint name="palm_ry" type="hinge" axis="0 1 0" damping="10"/>
      <joint name="palm_rz" type="hinge" axis="0 0 1" damping="10"/>

      <!-- Palm collision geometry -->
      <geom name="palm" type="box" size="0.031 0.012 0.045" pos="0.0055 -0.00175 0.042"
            friction="0.5" material="palm_mat"/>
      <geom type="box" size="0.018 0.0085 0.045" pos="-0.002 -0.0035 0.042"
            friction="0.5" material="palm_mat"/>

      <!-- First Finger (Index) -->
      <body name="ff_knuckle" pos="0.033 0 0.095">
        <joint name="ffj3" class="knuckle_joint"/>
        <geom name="ff_knuckle" type="sphere" size="0.008" material="link_mat"/>
        <body name="ff_proximal" pos="0 0 0">
          <joint name="ffj2" class="proximal_joint"/>
          <geom name="ff_proximal" type="cylinder" size="0.007 0.0225" pos="0 0 0.0225" material="link_mat"/>
          <body name="ff_middle" pos="0 0 0.045">
            <joint name="ffj1" class="middle_joint"/>
            <geom name="ff_middle" type="cylinder" size="0.007 0.0125" pos="0 0 0.0125" material="link_mat"/>
            <body name="ff_distal" pos="0 0 0.025">
              <joint name="ffj0" class="distal_joint"/>
              <geom name="ff_distal" type="cylinder" size="0.007 0.013" pos="0 0 0.013" material="link_mat"/>
              <body name="ff_tip" pos="0 0 0.026">
                <geom name="fingertip0" type="sphere" size="0.008" material="tip_mat"/>
                <site rgba="1 0 0 1" size="0.001" pos="0 0 0" name="ftp_0"/>
              </body>
            </body>
          </body>
        </body>
      </body>

      <!-- Middle Finger -->
      <body name="mf_knuckle" pos="0.011 0 0.099">
        <joint name="mfj3" class="knuckle_joint"/>
        <geom name="mf_knuckle" type="sphere" size="0.008" material="link_mat"/>
        <body name="mf_proximal" pos="0 0 0">
          <joint name="mfj2" class="proximal_joint"/>
          <geom name="mf_proximal" type="cylinder" size="0.007 0.0225" pos="0 0 0.0225" material="link_mat"/>
          <body name="mf_middle" pos="0 0 0.045">
            <joint name="mfj1" class="middle_joint"/>
            <geom name="mf_middle" type="cylinder" size="0.007 0.0125" pos="0 0 0.0125" material="link_mat"/>
            <body name="mf_distal" pos="0 0 0.025">
              <joint name="mfj0" class="distal_joint"/>
              <geom name="mf_distal" type="cylinder" size="0.007 0.013" pos="0 0 0.013" material="link_mat"/>
              <body name="mf_tip" pos="0 0 0.026">
                <geom name="fingertip1" type="sphere" size="0.008" material="tip_mat"/>
                <site rgba="1 0 0 1" size="0.001" pos="0 0 0" name="ftp_1"/>
              </body>
            </body>
          </body>
        </body>
      </body>

      <!-- Ring Finger -->
      <body name="rf_knuckle" pos="-0.011 0 0.095">
        <joint name="rfj3" class="knuckle_joint" axis="0 1 0"/>
        <geom name="rf_knuckle" type="sphere" size="0.008" material="link_mat"/>
        <body name="rf_proximal" pos="0 0 0">
          <joint name="rfj2" class="proximal_joint"/>
          <geom name="rf_proximal" type="cylinder" size="0.007 0.0225" pos="0 0 0.0225" material="link_mat"/>
          <body name="rf_middle" pos="0 0 0.045">
            <joint name="rfj1" class="middle_joint"/>
            <geom name="rf_middle" type="cylinder" size="0.007 0.0125" pos="0 0 0.0125" material="link_mat"/>
            <body name="rf_distal" pos="0 0 0.025">
              <joint name="rfj0" class="distal_joint"/>
              <geom name="rf_distal" type="cylinder" size="0.007 0.013" pos="0 0 0.013" material="link_mat"/>
              <body name="rf_tip" pos="0 0 0.026">
                <geom name="fingertip2" type="sphere" size="0.008" material="tip_mat"/>
                <site rgba="1 0 0 1" size="0.001" pos="0 0 0" name="ftp_2"/>
              </body>
            </body>
          </body>
        </body>
      </body>

      <!-- Little Finger -->
      <!-- URDF: palm->metacarpal at xyz="-0.033 0 0.02071" rpy="0 -0.9599 0" (55deg pitch down) -->
      <!-- Metacarpal collision in URDF: xyz="0.026986375 0 0.019" rpy="0 0.9599 0" size="0.018 0.024 0.040" -->
      <body name="lf_metacarpal" pos="-0.033 0 0.02071" quat="0.88701801 0 -0.46173483 0">
        <joint name="lfj4" class="lf_metacarpal_joint"/>
        <!-- Metacarpal geometry: positioned and rotated in metacarpal frame -->
        <geom name="lf_metacarpal" type="box" size="0.009 0.012 0.02" pos="0.026986375 0 0.019"
              quat="0.88701801 0 0.46173483 0" material="link_mat"/>
        <!-- knuckle position in metacarpal's rotated frame -->
        <body name="lf_knuckle" pos="0.05397275 0 0.03779463" quat="0.88701801 0 0.46173483 0">
          <joint name="lfj3" class="knuckle_joint" axis="0 1 0"/>
          <geom name="lf_knuckle" type="sphere" size="0.008" material="link_mat"/>
          <body name="lf_proximal" pos="0 0 0">
            <joint name="lfj2" class="proximal_joint"/>
            <geom name="lf_proximal" type="cylinder" size="0.007 0.0225" pos="0 0 0.0225" material="link_mat"/>
            <body name="lf_middle" pos="0 0 0.045">
              <joint name="lfj1" class="middle_joint"/>
              <geom name="lf_middle" type="cylinder" size="0.007 0.0125" pos="0 0 0.0125" material="link_mat"/>
              <body name="lf_distal" pos="0 0 0.025">
                <joint name="lfj0" class="distal_joint"/>
                <geom name="lf_distal" type="cylinder" size="0.007 0.013" pos="0 0 0.013" material="link_mat"/>
                <body name="lf_tip" pos="0 0 0.026">
                  <geom name="fingertip3" type="sphere" size="0.008" material="tip_mat"/>
                  <site rgba="1 0 0 1" size="0.001" pos="0 0 0" name="ftp_3"/>
                </body>
              </body>
            </body>
          </body>
        </body>
      </body>

      <!-- Thumb (5 joints) -->
      <!-- URDF: palm->thbase at xyz="0.034 -0.00858 0.029" rpy="-0.785398163397 0 -1.57079632679" -->
      <!-- That's rpy = [-45deg, 0deg, -90deg] -->
      <body name="th_base" pos="0.034 -0.00858 0.029" quat="0.65328148 -0.27059805 0.27059805 -0.65328148">
        <joint name="thj4" class="thumb_base1"/>
        <geom name="th_base" type="sphere" size="0.008" material="link_mat"/>
        <!-- THJ4 (thj4): axis="0 1 0" at origin="0 0 0" -->
        <body name="th_proximal" pos="0 0 0">
          <joint name="thj3" class="thumb_base2"/>
          <geom name="th_proximal" type="cylinder" size="0.008 0.019" pos="0 0 0.019" material="link_mat"/>
          <!-- THJ3 (thj2): axis="0 1 0" at origin="0 0 0.038" -->
          <body name="th_hub" pos="0 0 0.038">
            <joint name="thj2" class="thumb_mid1"/>
            <geom name="th_hub" type="sphere" size="0.007" material="link_mat"/>
            <!-- THJ2 (thj1): axis="1 0 0" at origin="0 0 0" -->
            <body name="th_middle" pos="0 0 0">
              <joint name="thj1" class="thumb_mid2"/>
              <geom name="th_middle" type="cylinder" size="0.007 0.016" pos="0 0 0.016" material="link_mat"/>
              <!-- THJ1 (thj0): axis="1 0 0" at origin="0 0 0.032" -->
              <body name="th_distal" pos="0 0 0.032">
                <joint name="thj0" class="thumb_distal"/>
                <geom name="th_distal" type="cylinder" size="0.007 0.01375" pos="0 0 0.01375" material="link_mat"/>
                <!-- Tip at origin="0 0 0.0275" -->
                <body name="th_tip" pos="0 0 0.0275">
                  <geom name="fingertip4" type="sphere" size="0.008" material="tip_mat"/>
                  <site rgba="1 0 0 1" size="0.001" pos="0 0 0" name="ftp_4"/>
                </body>
              </body>
            </body>
          </body>
        </body>
      </body>

    </body>
  </worldbody>

  <contact>
    <exclude body1="palm" body2="ff_knuckle"/>
    <exclude body1="palm" body2="mf_knuckle"/>
    <exclude body1="palm" body2="rf_knuckle"/>
    <exclude body1="palm" body2="lf_metacarpal"/>
    <exclude body1="palm" body2="th_base"/>
    <exclude body1="palm" body2="th_proximal"/>
  </contact>

  <actuator>
    <!-- Palm position actuators -->
    <position name="palm_x" joint="palm_tx" ctrlrange="-0.3 0.3" kp="10000"/>
    <position name="palm_y" joint="palm_ty" ctrlrange="-0.3 0.3" kp="10000"/>
    <position name="palm_z" joint="palm_tz" ctrlrange="-0.1 0.5" kp="10000"/>
    <!-- Palm rotation actuators -->
    <position name="palm_rotx" joint="palm_rx" kp="100"/>
    <position name="palm_roty" joint="palm_ry" kp="100"/>
    <position name="palm_rotz" joint="palm_rz" kp="100"/>

    <!-- First finger actuators (4 joints) -->
    <position name="ffa0" joint="ffj3" class="knuckle_joint" kp="1"/>
    <position name="ffa1" joint="ffj2" class="proximal_joint" kp="1"/>
    <position name="ffa2" joint="ffj1" class="middle_joint" kp="1"/>
    <position name="ffa3" joint="ffj0" class="distal_joint" kp="1"/>

    <!-- Middle finger actuators (4 joints) -->
    <position name="mfa0" joint="mfj3" class="knuckle_joint" kp="1"/>
    <position name="mfa1" joint="mfj2" class="proximal_joint" kp="1"/>
    <position name="mfa2" joint="mfj1" class="middle_joint" kp="1"/>
    <position name="mfa3" joint="mfj0" class="distal_joint" kp="1"/>

    <!-- Ring finger actuators (4 joints) -->
    <position name="rfa0" joint="rfj3" class="knuckle_joint" kp="1"/>
    <position name="rfa1" joint="rfj2" class="proximal_joint" kp="1"/>
    <position name="rfa2" joint="rfj1" class="middle_joint" kp="1"/>
    <position name="rfa3" joint="rfj0" class="distal_joint" kp="1"/>

    <!-- Little finger actuators (5 joints) -->
    <position name="lfa0" joint="lfj4" class="lf_metacarpal_joint" kp="1"/>
    <position name="lfa1" joint="lfj3" class="knuckle_joint" kp="1"/>
    <position name="lfa2" joint="lfj2" class="proximal_joint" kp="1"/>
    <position name="lfa3" joint="lfj1" class="middle_joint" kp="1"/>
    <position name="lfa4" joint="lfj0" class="distal_joint" kp="1"/>

    <!-- Thumb actuators (5 joints) -->
    <position name="tha0" joint="thj4" class="thumb_base1" kp="1"/>
    <position name="tha1" joint="thj3" class="thumb_base2" kp="1"/>
    <position name="tha2" joint="thj2" class="thumb_mid1" kp="1"/>
    <position name="tha3" joint="thj1" class="thumb_mid2" kp="1"/>
    <position name="tha4" joint="thj0" class="thumb_distal" kp="1"/>
  </actuator>

</mujoco>
